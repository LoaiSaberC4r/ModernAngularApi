<div class="login-container">
  <mat-card class="login-card">
    <mat-card-header>
      <mat-card-title>تغيير كلمة المرور / Change Password</mat-card-title>
      <mat-card-subtitle
        >يرجى تغيير كلمة المرور الأولية / Please change your initial password</mat-card-subtitle
      >
    </mat-card-header>

    <mat-card-content>
      @if (authService.errorMessage()) {
      <div class="alert alert-danger" role="alert">
        {{ authService.errorMessage() }}
      </div>
      }

      <form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>كلمة المرور الحالية / Current Password</mat-label>
          <input
            matInput
            [type]="hideCurrentPassword() ? 'password' : 'text'"
            formControlName="currentPassword"
            placeholder="أدخل كلمة المرور الحالية / Enter current password"
          />
          <button
            mat-icon-button
            matSuffix
            (click)="togglePasswordVisibility('current', $event)"
            type="button"
          >
            <mat-icon>{{ hideCurrentPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          @if (changePasswordForm.get('currentPassword')?.invalid &&
          changePasswordForm.get('currentPassword')?.touched) {
          <mat-error>كلمة المرور مطلوبة / Password is required</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>كلمة المرور الجديدة / New Password</mat-label>
          <input
            matInput
            [type]="hideNewPassword() ? 'password' : 'text'"
            formControlName="newPassword"
            placeholder="أدخل كلمة المرور الجديدة / Enter new password"
          />
          <button
            mat-icon-button
            matSuffix
            (click)="togglePasswordVisibility('new', $event)"
            type="button"
          >
            <mat-icon>{{ hideNewPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          @if (changePasswordForm.get('newPassword')?.invalid &&
          changePasswordForm.get('newPassword')?.touched) {
          <mat-error
            >كلمة المرور يجب أن تكون 6 أحرف على الأقل / Password must be at least 6
            characters</mat-error
          >
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>تأكيد كلمة المرور / Confirm Password</mat-label>
          <input
            matInput
            [type]="hideConfirmPassword() ? 'password' : 'text'"
            formControlName="confirmPassword"
            placeholder="أعد إدخال كلمة المرور / Re-enter password"
          />
          <button
            mat-icon-button
            matSuffix
            (click)="togglePasswordVisibility('confirm', $event)"
            type="button"
          >
            <mat-icon>{{ hideConfirmPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
        </mat-form-field>

        <button
          mat-raised-button
          color="primary"
          type="submit"
          class="full-width submit-button"
          [disabled]="authService.isLoading()"
        >
          @if (authService.isLoading()) {
          <mat-spinner diameter="20"></mat-spinner>
          } @else { تغيير كلمة المرور / Change Password }
        </button>
      </form>
    </mat-card-content>
  </mat-card>
</div>
