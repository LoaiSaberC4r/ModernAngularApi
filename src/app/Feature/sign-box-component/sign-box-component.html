<div class="container-fluid" [class.rtl]="isAr">
  <div class="header">
    <h1 class="title">
      {{ isAr ? 'Ø¥Ø¯Ø§Ø±Ø© Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±' : 'Traffic Signal Management' }}
    </h1>

    <div class="search-container">
      <div class="search-box">
        <i class="fas fa-search search-icon"></i>
        <input type="text" class="search-input"
          [placeholder]="isAr ? 'Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ù…Ø¹Ø±Ù‘Ù...' : 'Search by name or ID...'"
          [(ngModel)]="searchParameter.searchText" (ngModelChange)="onSearchEnter()"
          [attr.dir]="isAr ? 'rtl' : 'ltr'" />
      </div>

      <!-- Active Filter -->
      <div class="filter-dropdown active-filter-dropdown">
        <button class="filter-button" (click)="showActiveFilter = !showActiveFilter">
          <i class="fas fa-power-off"></i>
          {{ activeFilterLabel }}
          <i class="fas fa-chevron-down"></i>
        </button>
        <div class="filter-menu" [class.show]="showActiveFilter">
          <div class="filter-option" (click)="setActiveFilter('ALL')">
            <span>{{ isAr ? 'ØªØµÙÙŠØ© Ø§Ù„ÙƒÙ„' : 'Filter All' }}</span>
            <span class="checkmark">{{ activeFilter === 'ALL' ? 'âœ“' : '' }}</span>
          </div>
          <div class="filter-option" (click)="setActiveFilter('ACTIVE')">
            <span>{{ isAr ? 'Ù†Ø´ÙØ· ÙÙ‚Ø·' : 'Active Only' }}</span>
            <span class="checkmark">{{ activeFilter === 'ACTIVE' ? 'âœ“' : '' }}</span>
          </div>
          <div class="filter-option" (click)="setActiveFilter('INACTIVE')">
            <span>{{ isAr ? 'ØºÙŠØ± Ù†Ø´ÙØ· ÙÙ‚Ø·' : 'Inactive Only' }}</span>
            <span class="checkmark">{{ activeFilter === 'INACTIVE' ? 'âœ“' : '' }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Table -->
  <table class="traffic-table">
    <thead>
      <tr>
        <th>{{ isAr ? 'Ø§Ù„Ù…Ø¹Ø±Ù‘Ù' : 'ID' }}</th>
        <th>{{ isAr ? 'Ø¹Ù†ÙˆØ§Ù† IP' : 'IP Address' }}</th>
        <th>{{ isAr ? 'Ø§Ù„Ø§Ø³Ù…' : 'Name' }}</th>
        <th>{{ isAr ? 'Ø§Ù„Ø­Ø§Ù„Ø©' : 'Active' }}</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of filteredData" (mouseenter)="showPopup(item, $event)" (mousemove)="movePopup($event)"
        (mouseleave)="hidePopup()">
        <td>{{ item.id }}</td>
        <td dir="ltr">{{ item.ipAddress }}</td>
        <td>{{ item.name }}</td>
        <td>
          <span [ngClass]="item.active ? 'active' : 'inactive'">
            {{ item.active ? (isAr ? 'Ù†Ø´ÙØ·' : 'active') : isAr ? 'ØºÙŠØ± Ù†Ø´ÙØ·' : 'inactive' }}
          </span>
        </td>
      </tr>

      <tr *ngIf="filteredData.length === 0">
        <td colspan="4" class="no-results">
          {{ isAr ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø§Ø±Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø©' : 'No traffic signals found' }}
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Popup -->
  <div #popupRef class="traffic-popup" *ngIf="popupVisible" [ngStyle]="{ top: popupY + 'px', left: popupX + 'px' }">
    <div class="tp-header">
      <div class="tp-title">
        <span class="tp-dot connected"></span>
        <span class="tp-name">{{ popupData?.name || 'â€”' }}</span>
      </div>
      <span class="tp-chip">{{ isAr ? 'Ù…Ø¨Ø§Ø´Ø±' : 'Live' }}</span>
    </div>

    <div class="tp-grid">
      <div class="tp-col" *ngFor="let dir of popupData?.directions; let i = index">
        <div class="tp-col__head w-50">
          <span class="tp-col__label me-2">
            {{ isAr ? 'Ø§ØªØ¬Ø§Ù‡' : 'Direction' }}: {{ dir.name }}
          </span>
          <span class="tp-timer">
            {{ !isDisconnected ? dir.time + (isAr ? ' Ø«' : 's') : '--' }}
          </span>
        </div>
        <div class="traffic-light">
          <div class="tp-lamp"
            [ngClass]="{ 'is-red': true, disconnected: isDisconnected, active: dir.lightCode === 'R' }">
            ğŸ”´
          </div>
          <div class="tp-lamp" [ngClass]="{
              'is-yellow': true,
              disconnected: isDisconnected,
              active: dir.lightCode === 'Y'
            }">
            ğŸŸ¡
          </div>
          <div class="tp-lamp"
            [ngClass]="{ 'is-green': true, disconnected: isDisconnected, active: dir.lightCode === 'G' }">
            ğŸŸ¢
          </div>
        </div>
      </div>
    </div>
  </div>
</div>