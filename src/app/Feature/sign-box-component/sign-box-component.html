<div class="container-fluid">
  <div class="header">
    <h1 class="title">Traffic Signal Management</h1>

    <div class="search-container">
      <div class="search-box">
        <i class="fas fa-search search-icon"></i>
        <input
          type="text"
          class="search-input"
          placeholder="Search by name or ID..."
          [(ngModel)]="searchParameter.searchText"
          (keyup.enter)="onSearchEnter()"
        />
      </div>

      <!-- Active Filter -->
      <div class="filter-dropdown active-filter-dropdown">
        <button class="filter-button" (click)="showActiveFilter = !showActiveFilter">
          <i class="fas fa-power-off"></i>
          {{ activeFilter }}
          <i class="fas fa-chevron-down"></i>
        </button>
        <div class="filter-menu" [class.show]="showActiveFilter">
          <div class="filter-option" (click)="setActiveFilter('ALL')">
            <span>Filter All</span>
            <span class="checkmark">{{ activeFilter === 'ALL' ? 'âœ“' : '' }}</span>
          </div>
          <div class="filter-option" (click)="setActiveFilter('ACTIVE')">
            <span>Active Only</span>
            <span class="checkmark">{{ activeFilter === 'ACTIVE' ? 'âœ“' : '' }}</span>
          </div>
          <div class="filter-option" (click)="setActiveFilter('INACTIVE')">
            <span>Inactive Only</span>
            <span class="checkmark">{{ activeFilter === 'INACTIVE' ? 'âœ“' : '' }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Table -->
  <table class="traffic-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>IP Address</th>
        <th>Name</th>
        <th>Active</th>
      </tr>
    </thead>
    <tbody>
      <tr
        *ngFor="let item of filteredData"
        (mouseenter)="showPopup(item, $event)"
        (mousemove)="movePopup($event)"
        (mouseleave)="hidePopup()"
      >
        <td>{{ item.id }}</td>
        <td>{{ item.ipAddress }}</td>
        <td>{{ item.name }}</td>
        <td>
          <span [ngClass]="item.active ? 'active' : 'inactive'">
            {{ item.active ? 'active' : 'inactive' }}
          </span>
        </td>
      </tr>

      <tr *ngIf="filteredData.length === 0">
        <td colspan="4" class="no-results">No traffic signals found</td>
      </tr>
    </tbody>
  </table>

  <!-- Popup -->
  <div
    class="traffic-popup"
    *ngIf="popupVisible"
    [ngStyle]="{ top: popupY + 'px', left: popupX + 'px' }"
  >
    <div class="tp-header">
      <div class="tp-title">
        <span class="tp-dot connected"></span>
        <span class="tp-name">{{ popupData?.name || 'â€”' }}</span>
      </div>
      <span class="tp-chip">Live</span>
    </div>

    <div class="tp-grid">
      <div class="tp-col" *ngFor="let dir of popupData?.directions; let i = index">
        <div class="tp-col__head w-50">
          <span class="tp-col__label me-2">Ø§ØªØ¬Ø§Ù‡: {{ dir.name }}</span>
          <span class="tp-timer">
            {{ !isDisconnected ? dir.timer + 's' : '--' }}
          </span>
        </div>
        <div class="traffic-light">
          <div
            class="tp-lamp"
            [ngClass]="{ 'is-red': true, disconnected: isDisconnected, active: dir.code === 'R' }"
          >
            ðŸ”´
          </div>
          <div
            class="tp-lamp"
            [ngClass]="{
              'is-yellow': true,
              disconnected: isDisconnected,
              active: dir.code === 'Y'
            }"
          >
            ðŸŸ¡
          </div>
          <div
            class="tp-lamp"
            [ngClass]="{ 'is-green': true, disconnected: isDisconnected, active: dir.code === 'G' }"
          >
            ðŸŸ¢
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
