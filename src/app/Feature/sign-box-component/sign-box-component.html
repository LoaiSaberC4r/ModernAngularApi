<div class="container-fluid" [class.rtl]="isAr">
  <div class="header">
    <h1 class="title">
      {{ isAr ? 'إدارة إشارات المرور' : 'Traffic Signal Management' }}
    </h1>

    <div class="search-container">
      <div class="filter-dropdown search-box">
        <label class="filter-label">
          {{ isAr ? 'البحث' : 'Search' }}
        </label>
        <div style="position: relative; width: 100%;">
          <i class="fas fa-search search-icon"></i>
          <input type="text" class="search-input"
            [placeholder]="isAr ? 'ابحث بالاسم / ID / CabinetId...' : 'Search by name / ID / CabinetId...'"
            [(ngModel)]="searchParameter.searchText" (ngModelChange)="onSearchEnter()" [attr.dir]="isAr ? 'rtl' : 'ltr'"
            aria-label="search" />
        </div>
      </div>


      <!-- Active Filter -->
      <div class="filter-dropdown">
        <label class="filter-label">
          {{ isAr ? 'الحالة' : 'Active Filter' }}
        </label>
        <select class="filter-select" [(ngModel)]="activeFilter" (ngModelChange)="setActiveFilter($event)">
          <option value="ALL">{{ isAr ? 'الكل' : 'All' }}</option>
          <option value="ACTIVE">{{ isAr ? 'نشِط فقط' : 'Active Only' }}</option>
          <option value="INACTIVE">{{ isAr ? 'غير نشِط فقط' : 'Inactive Only' }}</option>
        </select>
      </div>

      <!-- Governorate Filter -->
      <div class="filter-dropdown">
        <label class="filter-label">{{ isAr ? 'المحافظة' : 'Governorate' }}</label>
        <select class="filter-select" [(ngModel)]="selectedGovernorateId"
          (ngModelChange)="onGovernorateChangeValue($event)">
          <option [ngValue]="null">{{ isAr ? 'الكل' : 'All' }}</option>
          <option *ngFor="let g of governates" [ngValue]="g.id">{{ g.name }}</option>
        </select>
      </div>

      <!-- Area Filter -->
      <div class="filter-dropdown">
        <label class="filter-label">{{ isAr ? 'الحي / المنطقة' : 'Area' }}</label>
        <select class="filter-select" [(ngModel)]="selectedAreaId" (ngModelChange)="onAreaChangeValue($event)">
          <option [ngValue]="null">{{ isAr ? 'الكل' : 'All' }}</option>
          <option *ngFor="let a of areas" [ngValue]="a.id">{{ a.name }}</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Table -->
  <table class="traffic-table">
    <thead>
      <tr>
        <th>{{ isAr ? 'ID الكابينة' : 'Cabinet ID' }}</th>
        <th>{{ isAr ? 'عنوان IP' : 'IP Address' }}</th>
        <th>{{ isAr ? 'الاسم' : 'Name' }}</th>
        <th>{{ isAr ? 'الإجراءات' : 'Actions' }}</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of filteredData" (mouseenter)="showPopup(item, $event)" (mousemove)="movePopup($event)"
        (mouseleave)="hidePopup()" [class.active-row]="isActive(item)">
        <td>{{ item.cabinetId }}</td>
        <td dir="ltr">{{ item.ipAddress }}</td>
        <td>{{ item.name }}</td>
        <td class="actions-cell">
          <span class="chip" [ngClass]="isActive(item) ? 'chip-active' : 'chip-inactive'">
            {{ isActive(item) ? (isAr ? 'نشِط' : 'Active') : (isAr ? 'غير نشِط' : 'Inactive') }}
          </span>
          <span class="chip chip-warning" *ngIf="!item.isApplied" (click)="onEdit(item)">
            {{ isAr ? 'مطلوب تحديث' : 'Required Update' }}
          </span>
        </td>
      </tr>
      <tr *ngIf="filteredData.length === 0">
        <td colspan="4" class="no-results">{{ isAr ? 'لا توجد إشارات مطابقة' : 'No traffic signals found' }}</td>
      </tr>
    </tbody>
  </table>
</div>